## docker-hubot

docker-hubot is a chat bot built on the [Hubot][hubot] framework. It was initially generated by [generator-hubot][generator-hubot]. mybot now runs in a Docker container.

[hubot]: http://hubot.github.com
[generator-hubot]: https://github.com/github/generator-hubot


## Development workflow. 

This repository is used to build a custom hubot image. The image is used by kubernetes.  Check the `drover` repo:

https://github.com/Zymergen/drover/blob/master/kubectl/hubot/hubot.yaml

There are two ways of adding functionality. 
 - adding packages from npm. e.g. search for: https://www.npmjs.com/search?q=hubot%20note
 - writing your own scripts. 


## For first approach. 
add the package to `package.json`. Build a docker image with: 

NOTE: replace 0.X.Y with the appropriate value which is generally 1 greater than the current version. 

`docker build . -t artifactory.zymergen.net:6556/com.zymergen/hubot:latest -t artifactory.zymergen.net:6556/com.zymergen/hubot:0.X.Y`

To push to artifactory:

`docker push artifactory.zymergen.net:6556/com.zymergen/hubot `

Note: you will need to be logged into artifactory for above. You can login using:
Note: username and password are in Lastpass.

`docker login artifactory.zymergen.net:6556`


Also note that this process is may change as we should update to using Jenkins as time permits.

Now we need to make the hubot container use the latest image you have built `0.X.Y`

edit: https://github.com/Zymergen/drover/blob/master/kubectl/hubot/hubot.yaml
line: 

`image: artifactory.zymergen.net:6556/com.zymergen/hubot:0.1.1`

to the next version i.e. one you have built: 

`image: artifactory.zymergen.net:6556/com.zymergen/hubot:0.X.Y`

run: `kubectl apply -f hubot.yaml -n tools`

Note: above assumes you have access to the `tools` namespace and are pointing to the `rancher2` cluster. 

https://wiki.zymergen.net/display/DEV/Set+up+kubectl+with+our+remote+clusters


## Developing custom scripts and/or testing locally. 

You can write a custom script. put it in the scripts folder.

- create docker image using the `Dockerfile.local` command tag it with `hubot-local`
- docker build .  -t hubot-local -f Dockerfile.local
- Modify `docker-compose.yaml` to use image for mybot as `hubot-local`
- set the `SLACK_TOKEN` ENV variable .. you can get this from Gajanan or Victor or Shannon 
- run: `docker-compose up`
-NOW YOU SHOULD SEE: hubot docker image running. 
- invite the bot to a channel and test.  

# For adding custom scripts to work on the container running in kubernetes see Readme at:

https://github.com/Zymergen/drover/tree/master/kubectl/hubot

# Package configurations. 

If you are adding a package that needs confiruations/environment variables. These are set through secrets.

Modify the kubernetes secret `hubot` in the `tools` namespace. Can be done through the `kubectl` command or by the `rancher2` UI. 

 









